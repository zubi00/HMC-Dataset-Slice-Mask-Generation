import osimport shutilimport pydicomdef sanitize_folder_name(name):    """Sanitize folder names to make them filesystem-safe."""    return "".join(c if c.isalnum() or c in " _-" else "_" for c in name)def organize_dicom_by_patient(main_folder, target_folder):    for root, _, files in os.walk(main_folder):        for file in files:            if file.endswith(".dcm"):                source_path = os.path.join(root, file)                try:                    dicom_data = pydicom.dcmread(source_path)                                        # Extract patient name                    patient_name = getattr(dicom_data, "PatientName", "UnknownPatient")                    patient_name_str = sanitize_folder_name(str(patient_name))                                        # Determine if file is a mask                    is_mask = file.startswith("RS")                    if is_mask:                        modality = "Masks"                        series_description = "Mask Files"                    else:                        # Extract modality, SeriesDescription, and UIDs                        modality = dicom_data.get("Modality", "UnknownModality")                        series_description = sanitize_folder_name(                            dicom_data.get("SeriesDescription", "UnknownSeries")                        )                        study_instance_uid = dicom_data.get("StudyInstanceUID", "UnknownStudyUID")                        series_instance_uid = dicom_data.get("SeriesInstanceUID", "UnknownSeriesUID")                        patient_id = dicom_data.get("PatientID", "UnknownPatientID")                    # Determine the folder structure                    patient_folder = os.path.join(target_folder, patient_name_str)                    modality_folder = os.path.join(patient_folder, modality)                    # Mask files go directly into the Masks folder                    if is_mask:                        series_folder = os.path.join(modality_folder, series_description)                    else:                        uid_folder_name = f"{study_instance_uid}_{series_instance_uid}_{patient_id}"                        series_folder = os.path.join(                            modality_folder, uid_folder_name + "_" + series_description                        )                                        # Create directories if they do not exist                    os.makedirs(series_folder, exist_ok=True)                    # Copy file to the appropriate location                    target_path = os.path.join(series_folder, file)                    shutil.copy(source_path, target_path)                    print(f"Copied {source_path} to {target_path}")                                except Exception as e:                    print(f"Error processing file {file}: {e}")def main():    main_folder = "/Users/zubairsaeed/Downloads/PhD/H&N/Patients/Head&Neck"    target_folder = "/Users/zubairsaeed/Downloads/PhD/H&N/Patients/H&N-Organized"    organize_dicom_by_patient(main_folder, target_folder)if __name__ == "__main__":    main()